"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const mongodb_1 = require("mongodb");
class MongoUtils {
    static toObjectId(id) {
        try {
            return new mongodb_1.ObjectID(id);
        }
        catch (err) {
            return undefined;
        }
    }
    static prepareUpdateObject(dto, prefix) {
        return Object.entries(dto || {}).reduce((acc, [key, value]) => {
            const _key = [prefix, key].filter(item => item).join('.');
            return !Array.isArray(value) && value && typeof value === 'object' && Object.keys(value).length ?
                Object.assign(MongoUtils.prepareUpdateObject(value, _key), acc) :
                Object.assign({ [_key]: value }, acc);
        }, {});
    }
    static filterFindCondition(condition) {
        if (condition.id || condition._id) {
            condition._id = MongoUtils.toObjectId(condition.id || condition._id);
            delete condition.id;
        }
        return condition;
    }
    static fieldsStringFromArray(fields) {
        if (!fields || !fields.length) {
            return '';
        }
        return fields.filter(f => !!f && f.trim().length).map(f => f.trim()).join(' ');
    }
}
exports.MongoUtils = MongoUtils;
//# sourceMappingURL=mongo-utils.service.js.map